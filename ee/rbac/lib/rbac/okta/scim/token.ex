defmodule Rbac.Okta.Scim.Token do
  @moduledoc """
  All SCIM requests are authorized with a Bearer token.
  The token is generated by Semaphore, and added to Okta by the Okta
  administrator.

  We don't store the actual tokens in our system, only their sha256 fingerprint.
  """

  def hash(token) do
    :crypto.hash(:sha256, to_charlist(token))
  end

  def generate do
    random_crypto_secure_string(64)
  end

  defp random_crypto_secure_string(length) do
    :crypto.strong_rand_bytes(length) |> Base.url_encode64() |> binary_part(0, length)
  end
end
